---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r include=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(lubridate)
```
## Loading and preprocessing the data

First, we will unzip the data and read it.

```{r message=FALSE, warning=FALSE}
zip_fn = 'activity.zip'
data_fn = 'activity.csv'

unzip(zip_fn)
df <- read_csv(data_fn)

head(df)
str(df)
summary(df)
```

The dataset is read correctly and columns are in the right format. We will deal with missing values later

## What is mean total number of steps taken per day?

Let us look into distribution of total number of steps per day.

```{r}
total_steps <- df %>%
  group_by(date) %>%
  summarise(total_steps = sum(steps))

total_steps %>% 
  ggplot(aes(total_steps)) + 
  geom_histogram(bins = 10)
```

Now, we compute center values (mean and median) of total steps. Since distribution is close to normal we expect them to be close.

```{r}
middle_values <- total_steps %>% 
  summarise(mean_steps = mean(total_steps, na.rm = T), 
            median = median(total_steps, na.rm = T))
knitr::kable(middle_values)
```

## What is the average daily activity pattern?

```{r}
avg_daily_pattern <- df %>%
  group_by(interval) %>%
  summarise(mean_steps = mean(steps, na.rm = T))

avg_daily_pattern %>% ggplot(aes(interval, mean_steps)) +
  geom_line() +
  labs(title = 'Average daily activity', 
       x = '5-minute interval', 
       y = 'Number of steps')
```

```{r}
max <- max(avg_daily_pattern$mean_steps)
max_int <- avg_daily_pattern %>% 
  filter(mean_steps == max) %>% 
  select(interval) %>% 
  unlist
```

On average, maximum steps (`r round(max)`) is are taken during `r max_int`'s 5-minute interval.

## Imputing missing values

First, let us calculate how many missing values are in the dataset.

```{r}
na_count = sapply(df, function(x) sum(is.na(x)))
knitr::kable(na_count)
```
Only steps column contains missing values. There are `r na_count['steps']` (`r round(na_count['steps']/nrow(df)*100, 2)`%).

We will fill missing data with median number of steps for interval.

```{r}
df02 <- df %>% 
  group_by(interval) %>%
  summarise(median = median(steps, na.rm = T)) %>% 
  inner_join(df, by = 'interval') %>%
  mutate(steps = ifelse(is.na(steps), median, steps)) %>%
  select(date, interval, steps) %>%
  arrange(date, interval)
```

How imputation of missing values changes the total steps per day distribution?

```{r}
total_steps02 <- df02%>%
  group_by(date) %>%
  summarise(total_steps = sum(steps))

total_steps02 %>% 
  ggplot(aes(total_steps)) + 
  geom_histogram(bins = 10)
```

```{r}
middle_values02 <- total_steps02 %>% 
  summarise(mean_steps = mean(total_steps, na.rm = T), 
            median = median(total_steps, na.rm = T))
knitr::kable(middle_values02)
```

It skewed distribution to the left and lowered center values, especially the mean.

## Are there differences in activity patterns between weekdays and weekends?

```{r}
df02 <- df02 %>% 
  mutate(weekday_end = factor(if_else(wday(date) %in% c(1,7), 
                                      'weekend', 'weekday')))
wdayend_steps <- df02 %>%
  group_by(weekday_end, interval) %>%
  summarise(mean_steps = mean(steps))

wdayend_steps %>% ggplot(aes(interval, mean_steps)) +
  geom_line() +
  facet_grid(weekday_end ~ .) +
  labs(title = 'Average daily activity', 
       x = '5-minute interval', 
       y = 'Number of steps')
```